// Texto base para la matriz evolutiva
const textoBase = `
  Estamos ubicados en Cerezos 19, Nezahualc√≥yotl. Vendemos arreglos, regalos y diferentes tipos de plantas.
  Puedes encontrar plantas como suculentas, cactus y plantas de sombra.
  Para cuidar tus plantas, ri√©galas moderadamente, dales buena luz y limpia sus hojas.
  Regalos personalizados como terrarios y kits de jardiner√≠a est√°n disponibles.
  Centros de mesa √∫nicos para eventos como bodas, cumplea√±os y XV a√±os.
    Contamos con servicio de env√≠o a domicilio en la CDMX y √°rea metropolitana.
    Hola, buenas tardes. ¬øEn qu√© puedo ayudarte?.
    Hola que tal, ¬øen qu√© puedo ayudarte hoy?.
    Buenos dias, ¬øen qu√© puedo ayudarte?.
    Buenas noches, ¬øen qu√© puedo ayudarte?.
    El horario de atenci√≥n es de lunes a s√°bado de 12:00 a 6:00 p.m
    Contamos con servicio de env√≠o a domicilio.
    Nochebuenas, hortencias, begonias y m√°s solo en tu tienda de confianza 
    Los centros de mesa con plantas son una tendencia
     elegante y sostenible que puede a√±adir un toque natural y fresco a cualquier celebraci√≥n. Para bodas, las suculentas como Echeveria elegans y Crassula ovata son perfectas por su durabilidad y est√©tica minimalista, mientras que las orqu√≠deas mini en macetas transparentes ofrecen una opci√≥n delicada. En cumplea√±os, las plantas con personalidad colorida como Kalanchoe y Anturios brindan vibrantes floraciones, y los terrarios individuales pueden convertirse en un regalo especial. Para graduaciones, plantas que simbolizan crecimiento como el Bamb√∫ de la suerte o el Ficus benjamina representan desarrollo y √©xito.
Las plantas se pueden clasificar seg√∫n su nivel
 de cuidado: las de cuidado m√≠nimo como suculentas y 
 cactus miniatura son ideales para eventos, mientras que las de cuidado b√°sico como Pothos y Sansevierias requieren atenci√≥n simple. Las de cuidado moderado como Orqu√≠deas y Anturios demandan un poco m√°s de dedicaci√≥n.
    Un detalle extraordinario es que estos centros de mesa pueden convertirse en recuerdos √∫nicos que los invitados pueden cultivar posteriormente, a√±adiendo un valor sentimental al evento.
Para espacios interiores con mucha luz natural, recomendamos plantas como el Ficus Lyrata que genera un impacto decorativo espectacular, o la Monstera Deliciosa que no solo se adapta perfectamente sino que crea un ambiente tropical inmediato. Si tu espacio tiene poca iluminaci√≥n, nuestras aliadas ser√°n las Sansevierias, Pothos y Zamioculcas, plantas incre√≠blemente resistentes que prosperan en condiciones de sombra.
En espacios reducidos como apartamentos peque√±os o cub√≠culos de oficina, apostamos por 
terrarios miniatura y plantas colgantes como los Pothos o Senecio que aprovechan la verticalidad sin ocupar espacio en el suelo. Para balcones y terrazas con exposici√≥n directa al sol, seleccionamos cactus, suculentas gruesas y plantas arom√°ticas mediterr√°neas que adoran recibir luz intensa.
  No solo vendemos plantas, ofrecemos asesor√≠a personalizada. Conocemos los microclimas de nuestra localidad,
   sabemos c√≥mo afecta la humedad, el calor y la luz en cada tipo de vivienda. Te acompa√±amos no solo en la compra, sino en el cuidado de tu nueva planta. Cada cliente se va con instrucciones claras y precisas para que su planta prospere.
  Realizamos entregas a domicilio en toda Nezahualc√≥yotl y √°reas cercanas. Si no puedes venir a la tienda, nosotros 
  llegamos hasta tu puerta con tu nueva planta compa√±era. Tambi√©n tenemos un servicio de consulta r√°pida por WhatsApp para resolver dudas de cuidado y mantenimiento.
Nuestro horario es de lunes a s√°bado de 12:00 a 6:00 p.m. Estamos ubicados en Cerezos 19, frente al parque principal. 
Puedes encontrarnos por Facebook como Kedros Plantas y suculentas, donde compartimos consejos, promociones y el mundo verde que nos apasiona.
    Las plantas se pueden clasificar seg√∫n su nivel
 de cuidado: las de cuidado m√≠nimo como suculentas y 
 cactus miniatura son ideales para eventos, mientras que las de cuidado b√°sico como Pothos y Sansevierias requieren atenci√≥n simple. Las de cuidado moderado como Orqu√≠deas y Anturios demandan un poco m√°s de dedicaci√≥n.
    Un detalle extraordinario es que estos centros de mesa pueden convertirse en recuerdos √∫nicos que los invitados pueden cultivar posteriormente, a√±adiendo un valor sentimental al evento.
Para espacios interiores con mucha luz natural, recomendamos plantas como el Ficus Lyrata que genera un impacto decorativo espectacular, o la Monstera Deliciosa que no solo se adapta perfectamente sino que crea un ambiente tropical inmediato. Si tu espacio tiene poca iluminaci√≥n, nuestras aliadas ser√°n las Sansevierias, Pothos y Zamioculcas, plantas incre√≠blemente resistentes que prosperan en condiciones de sombra.
En espacios reducidos como apartamentos peque√±os o cub√≠culos de oficina, apostamos por 
terrarios miniatura y plantas colgantes como los Pothos o Senecio que aprovechan la verticalidad sin ocupar espacio en el suelo. Para balcones y terrazas con exposici√≥n directa al sol, seleccionamos cactus, suculentas gruesas y plantas arom√°ticas mediterr√°neas que adoran recibir luz intensa.
  No solo vendemos plantas, ofrecemos asesor√≠a personalizada. Conocemos los microclimas de nuestra localidad,
   sabemos c√≥mo afecta la humedad, el calor y la luz en cada tipo de vivienda. Te acompa√±amos no solo en la compra, sino en el cuidado de tu nueva planta. Cada cliente se va con instrucciones claras y precisas para que su planta prospere.
  Realizamos entregas a domicilio en toda Nezahualc√≥yotl y √°reas cercanas. Si no puedes venir a la tienda, nosotros 
  llegamos hasta tu puerta con tu nueva planta compa√±era. Tambi√©n tenemos un servicio de consulta r√°pida por WhatsApp para resolver dudas de cuidado y mantenimiento.
Nuestro horario es de lunes a s√°bado de 12:00 a 6:00 p.m. Estamos ubicados en Cerezos 19, frente al parque principal. 
Puedes encontrarnos por Facebook como Kedros Plantas y suculentas, donde compartimos consejos, promociones y el mundo verde que nos apasiona.
    La hortensia es de resolana
Contamos con sustrato para anturio, as√≠ mismo, contamos con macetas de barro, pl√°stico y de cer√°mica.
    si, Contamos con servicio de env√≠o a domicilio
    si, Contamos con tierra preparada para todo tipo de planta
    si, Contamos con servicio de env√≠o a domicilio

`;



// Construcci√≥n de la matriz evolutiva
function construirMatrizEvolutiva(texto) {
  const palabras = texto.toLowerCase().replace(/[.,]/g, '').split(/\s+/);
  const matriz = {};

  for (let i = 0; i < palabras.length - 1; i++) {
    const palabraActual = palabras[i];
    const palabraSiguiente = palabras[i + 1];

    if (!matriz[palabraActual]) {
      matriz[palabraActual] = {};
    }

    matriz[palabraActual][palabraSiguiente] = (matriz[palabraActual][palabraSiguiente] || 0) + 1;
  }

  // Convertir a probabilidades
  for (const palabra in matriz) {
    const total = Object.values(matriz[palabra]).reduce((sum, count) => sum + count, 0);
    for (const siguiente in matriz[palabra]) {
      matriz[palabra][siguiente] /= total;
    }
  }

  return matriz;
}

// Predicci√≥n de la pr√≥xima palabra
function predecirPalabra(matriz, palabraActual) {
  const transiciones = matriz[palabraActual];
  if (!transiciones) return null;

  const aleatorio = Math.random();
  let acumulado = 0;

  for (const [palabra, probabilidad] of Object.entries(transiciones)) {
    acumulado += probabilidad;
    if (aleatorio <= acumulado) {
      return palabra;
    }
  }
  return null;
}

// Generar respuesta basada en la matriz
function generarRespuesta(pregunta, matriz, limite = 20) {
  const palabrasPregunta = pregunta.toLowerCase().split(' ');
  let palabraActual = palabrasPregunta[palabrasPregunta.length - 1];

  if (!matriz[palabraActual]) {
    return "Lo siento, no entiendo tu pregunta. ¬øPodr√≠as reformularla?";
  }

  let respuesta = [];
  for (let i = 0; i < limite; i++) {
    palabraActual = predecirPalabra(matriz, palabraActual);
    if (!palabraActual) break;
    respuesta.push(palabraActual);
  }

  return respuesta.length ? respuesta.join(' ') : "No tengo informaci√≥n suficiente para responder.";
}

// Lista de frases aleatorias para respuestas menos precisas
const frasesAleatorias = [
  "Recuerda que las plantas necesitan luz y amor. üå±",
  "¬°Los cactus son una excelente opci√≥n para principiantes!",
  "Te recomiendo explorar nuestras opciones de suculentas y cactus.",
  "No olvides revisar el nivel de humedad de tus macetas.",
  "Estamos para ayudarte con cualquier duda sobre plantas.",
  "¬øSab√≠as que los terrarios son tendencia para regalar? üåµ",
  "Las plantas colgantes son perfectas para espacios peque√±os.",
  "Consulta nuestro horario para visitarnos en persona.",
  "Las suculentas se riegan cada dos semanas, aproximadamente.",
  "Prueba con un Ficus Lyrata, ¬°es ideal para interiores iluminados!",
  "Revisamos nuestras promociones en redes sociales regularmente. üòä",
  "Si necesitas tierra preparada, nosotros la tenemos.",
  "Estamos ubicados en Cerezos 19",
  "Contamos con servicio de env√≠o a domicilio",
  "Tenemos un horario de 12pm a 6pm de lunes a s√°bado",
  "¬øEn qu√© m√°s puedo ayudarte hoy?",
  "¬°Gracias por tu pregunta! üåø",
];

// Generar respuesta con precisi√≥n ajustada
function generarRespuestaConAjuste(pregunta, matriz, limite = 20) {
  const probabilidadExactitud = 0.8; // 80% de responder seg√∫n la matriz
  const esRespuestaPrecisa = Math.random() < probabilidadExactitud;

  if (esRespuestaPrecisa) {
    // Responder seg√∫n la matriz evolutiva
    return generarRespuesta(pregunta, matriz, limite);
  } else {
    // Responder con una frase aleatoria
    const indiceAleatorio = Math.floor(Math.random() * frasesAleatorias.length);
    return frasesAleatorias[indiceAleatorio];
  }
}

// Enviar preguntas y generar respuestas
function sendCustomQuestion() {
  const input = document.getElementById('questionInput');
  const pregunta = input.value.trim();
  if (pregunta) {
    addMessage(pregunta, true);

    setTimeout(() => {
      const limiteDinamico = 15; 
      const respuesta = generarRespuestaConAjuste(pregunta, matrizEvolutiva, limiteDinamico);
      addMessage(respuesta, false);
    }, 500);

    input.value = '';
  }
}

// Mostrar mensajes en el chat
function addMessage(text, isUser) {
  const chatContainer = document.getElementById('chatContainer');
  const messageDiv = document.createElement('div');
  messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
  messageDiv.textContent = text;
  chatContainer.appendChild(messageDiv);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Inicializar chatbot
window.onload = function () {
  addMessage("¬°Hola! Soy Leafi, tu asistente virtual de plantas. ¬øEn qu√© puedo ayudarte hoy? üå±", false);
};

// Construir matriz evolutiva con el texto base
const matrizEvolutiva = construirMatrizEvolutiva(textoBase);
